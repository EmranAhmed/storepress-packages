import { Meta } from '@storybook/blocks';

<Meta title="Utils/Plugin Example" />

## Install

```shell
npm i @storepress/utils --save
```

## Usage

```jsx
import { getOptionsFromAttribute, createPluginInstance, getPluginInstance } from '@storepress/utils';
```

## Example Plugin `Plugin.js`
```js
/**
 * External dependencies
 */
import { getOptionsFromAttribute } from '@storepress/utils'

function Plugin(element, options) {
    // Default Settings
    const DEFAULTS = {
        size: 20,
    }

    // Collecting settings from html attribute
    const ATTRIBUTE = 'data-my-plugin'

    const handleInput = (event) => {
        window.console.log(event.target.value)
    }

    const addEvents = () => {
        this.$element.querySelectorAll('input').forEach(($el) => {
            $el.addEventListener('input', handleInput)
        })
    }

    const addClass = () => {
       this.$element.querySelectorAll('input').forEach(($el) => {
            $el.classList.add('example-input-class')
        })
    }

    const removeClass = () => {
      this.$element.querySelectorAll('input').forEach(($el) => {
            $el.classList.remove('example-input-class')
      })
    }

    const removeEvents = () => {
        this.$element.querySelectorAll('input').forEach(($el) => {
            $el.removeEventListener('input', handleInput)
        })
    }

    const reset = () => {
        removeEvents()
        removeClass()
    }

    // Expose to public.
    const expose = () => ({
        reset
    })


    // Do what you need and return expose fn.
    const init = () => {
        this.$element = element
        this.settings = {
              ...DEFAULTS,
              ...options,
              ...getOptionsFromAttribute( this.$element, ATTRIBUTE)
            };

        addClass()

        addEvents()

        return expose()
    }

    return init()
}

export { Plugin }
```
## Make Plugin Instance `index.js`
```js

import { createStorePressPlugin } from '@storepress/utils'
import { Plugin } from './Plugin.js'

// Create and setup the plugin
const MyPlugin = createStorePressPlugin({
    selector: '[data-my-plugin]',
    plugin: Plugin,
    namespace: 'my-plugin',
    options: { message: 'Default message' },
})

MyPlugin.setup()

export default MyPlugin
```

## Using the Plugin `script.js`

```javascript
import MyPlugin from './index.js';

document.addEventListener( 'DOMContentLoaded', () => {
    MyPlugin.init();
} );
```

## Method: 01
- If you want to access `Slider` globally. Attach `Slider` with `Window` like:

```js
/**
 * External dependencies
 */
import domReady from '@wordpress/dom-ready';
import {
  getPluginInstance,
  getStorePressPlugin,
  triggerEvent
} from '@storepress/utils';

domReady(function () {

// Method 1: Get specific plugin instance
const plugin = getPluginInstance('.element', 'slider');

// Method 2: Get via plugin manager
const plugin = getStorePressPlugin('slider').get('.element');

// Method 3: Get all plugin instances
const allSliders = getStorePressPlugin('slider').get();

// Slider.init()
// Slider.destroy()

allSliders.forEach(instance => {
  instance.handleNext(); // Access plugin exposed functions.
});
})
```
## Method: 02
- If you don't want to access `Slider` globally. Use event.

```js

// Method 1: Get specific plugin instance
const plugin = StorePress.Utils.getPluginInstance('.element', 'slider');

// Method 2: Get via plugin manager
const plugin = StorePress.Utils.getStorePressPlugin('slider').get('.element');

// Method 3: Get all plugin instances
const allSliders = StorePress.Utils.getStorePressPlugin('slider').get();

// Slider.init()
// Slider.destroy()

allSliders.forEach(instance => {
  instance.handleNext(); // Access plugin exposed functions.
});
```

## Example HTML

```html
<div id="container">
    <div class="slider-wrapper inp" data-slider-settings="{'size': 40}">
        <a>1</a>
        <form>
            <input type="text" placeholder="Location X">
        </form>
    </div>

    <div class="slider-wrapper inp" data-slider-settings--size="30">
        <a>2</a>
        <form>
            <input type="text" placeholder="Location Y">
        </form>
    </div>
</div>
```